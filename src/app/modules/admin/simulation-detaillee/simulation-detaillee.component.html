<!-- <div class="flex flex-col flex-auto min-w-0 overflow-hidden" [@fadeInRight]="{value:'', params: {duration: 700}}"> -->
<div class="absolute inset-0 flex flex-col min-w-0 overflow-y-auto scroll-smooth" [@fadeInRight]="{value:'', params: {duration: 700}}" cdkScrollable>

    <!-- Header -->
    <header class="hidden md:flex flex-col items-center justify-center px-16 w-full min-h-[30vh] simul-det-bg-header">
        <div class="w-full max-w-400">
            <div class="max-w-xl text-2xl md:text-3xl font-bold uppercase tracking-tight leading-tight text-white">
                Bienvenur Mr LAMDA Beta
            </div>
            <div class="max-w-xl hidden md:block text-2xl text-white mt-3">
                Prenez quelques minutes pour décrire votre projet
            </div>

            <!-- <div class="max-w-xl hidden md:block text-2xl text-white mt-3">
                C'est simple, rapide et sans engagement. Plus vous serez complet dans la description de votre situation et plus notre comparaison des meilleurs taux pour vous sera précise !
            </div> -->
        </div>
    </header>

    <div class="px-5 sm:px-16 max-md:py-10 md:pb-20 simul-det-bg-header-sm">

        <div class="w-full max-w-400 mx-auto">

            <span class="md:hidden text-2xl md:text-4xl uppercase font-extrabold leading-tight tracking-tight text-primary">
                Je simule mon crédit
            </span>

            <!-- matBadge="3" matBadgePosition="before" -->
            <!-- <div class="hidden md:flex flex-row justify-center space-x-5">
                <div class="flex flex-col items-center p-5 rounded-2xl shadow bg-card ring ring-1 ring-gray-500 w-68">
                    <mat-icon
                        class="absolute top-0 right-0 mt-3 mr-3 icon-size-5 text-green-600"
                        [svgIcon]="'heroicons_solid:badge-check'">
                    </mat-icon>
                    <span class="font-medium">Je simule mon crédit</span>
                </div>
                <div class="flex flex-col items-center p-5 rounded-2xl shadow bg-primary ring ring-1 ring-gray-500 w-68">
                    <span class="font-medium text-white">Je personnalise ma simulation</span>
                </div>
                <div class="flex flex-col items-center p-5 rounded-2xl shadow bg-card ring ring-1 ring-gray-500 w-68">
                    <span class="font-medium">Je demande mon crédit</span>
                </div>
            </div> -->

            <fuse-card class="mx-auto hidden md:flex w-fit flex flex-row items-center -mt-12 h-24 shadow-md">
                <div class="relative w-68 h-full flex items-center justify-center overflow-hidden">
                    <!-- <div class="z-10 absolute left-0 -top-12 text-10xl font-bold opacity-10 text-gray-700">01</div> -->
                    <!-- <div class="z-10 absolute left-3 top-1 text-3xl font-bold opacity-50 text-gray-500">01</div> -->
                    <div class="absolute bottom-0 right-0 w-18 h-18 -m-5">
                        <mat-icon
                            class="icon-size-18 opacity-25 text-green-500 dark:text-green-400"
                            [svgIcon]="'heroicons_outline:check-circle'"></mat-icon>
                    </div>
                    <span class="text-lg font-semibold">Je simule mon crédit</span>
                </div>
                <div class="w-88 h-full flex items-center justify-center bg-primary">
                    <!-- <div class="z-10 absolute left-3 top-1 text-3xl font-bold opacity-50 text-white">02</div> -->
                    <!-- <div class="z-10 absolute left-0 -top-12 text-10xl font-bold opacity-10 text-gray-700">02</div> -->
                    <span class="text-lg font-semibold text-white">Je personnalise ma simulation</span>
                </div>
                <div class="w-72 h-full flex items-center justify-center">
                    <!-- <div class="z-10 absolute left-0 -top-12 text-10xl font-bold opacity-20 text-white">03</div> -->
                    <!-- <div class="z-10 absolute left-3 top-1 text-3xl font-bold opacity-50 text-gray-500">03</div> -->
                    <!-- <span class="z-20 text-lg font-semibold ml-12 mt-2">Je demande mon crédit</span> -->
                    <span class="text-lg font-semibold">Je demande mon crédit</span>
                </div>
            </fuse-card>

            <div class="flex flex-col md:flex-row md:items-start max-md:space-y-10 md:space-x-7 mt-10 md:mt-14">

                <form class="ring-1 ring-current bg-card rounded-md shadow overflow-hidden"
                    [formGroup]="simulationStepperForm"
                    [@resize]="!isScreenSmall && animationState">

                    <mat-horizontal-stepper
                        [linear]="true"
                        labelPosition="bottom"
                        #simulationStepper
                        class="mat-stepper-label-position-top bg-transparent">
                        
                        <!-- <ng-template matStepperIcon="edit" let-index="index">{{index + 1}}</ng-template>
                        <ng-template matStepperIcon="done" let-index="index">{{index + 1}}</ng-template> -->
                        <!-- <ng-template matStepperIcon="done">
                            <mat-icon>account_circle</mat-icon>
                        </ng-template>
                        <ng-template matStepperIcon="active">
                            <mat-icon>account_circle</mat-icon>
                        </ng-template> -->
                        <ng-template matStepperIcon="edit">
                            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_outline:check'">
                            </mat-icon>
                        </ng-template>
                        <!-- <ng-template matStepperIcon="number" let-index="index">
                            <span *ngIf="simulationStepperForm.get(tab[index]).pristine || simulationStepperForm.get(tab[index]).invalid">{{index + 1}}</span>
                            <mat-icon 
                                *ngIf="!simulationStepperForm.get(tab[index]).pristine && simulationStepperForm.get(tab[index]).valid"
                                [svgIcon]="'heroicons_outline:check'">
                            </mat-icon>
                        </ng-template> -->
                        
                        <mat-step 
                            [formGroupName]="'step1'"
                            [stepControl]="simulationStepperForm.get('step1')"
                            [label]="isXsScreen ? '' : 'Mon profil'"
                            #simulationStepperStep1>

                            <div class="w-full grid grid-cols-2 gap-x-2 md:mt-5">

                                <!-- Nom -->
                                <mat-form-field class="w-full"
                                    [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                                    <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:user'" matPrefix>
                                    </mat-icon>
                                    <input matInput [formControlName]="'nom'">
                                    <mat-label class="text-sm font-semibold">Nom</mat-label>
                                    <mat-error *ngIf="simulationStepperForm.get('step1').get('nom').hasError('required')">
                                        Nom obligatoire
                                    </mat-error>
                                </mat-form-field>

                                <!-- Prénom -->
                                <mat-form-field class="w-full"
                                    [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                                    <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:user'" matPrefix>
                                    </mat-icon>
                                    <input matInput [formControlName]="'prenom'">
                                    <mat-label class="text-sm font-semibold">Prénom</mat-label>
                                    <mat-error *ngIf="simulationStepperForm.get('step1').get('prenom').hasError('required')">
                                        Prénom obligatoire
                                    </mat-error>
                                </mat-form-field>

                                <!-- Téléphone -->
                                <mat-form-field class="w-full"
                                    [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                                    <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:phone'" matPrefix>
                                    </mat-icon>
                                    <input matInput [formControlName]="'telephone'">
                                    <mat-label class="text-sm font-semibold">Téléphone</mat-label>
                                    <mat-error *ngIf="simulationStepperForm.get('step1').get('telephone').hasError('required')">
                                        Téléphone obligatoire
                                    </mat-error>
                                </mat-form-field>

                                <!-- Email -->
                                <mat-form-field class="w-full"
                                    [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                                    <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:mail'"
                                        matPrefix></mat-icon>
                                    <input type="email" matInput [formControlName]="'email'">
                                    <mat-label class="text-sm font-semibold">E-mail</mat-label>
                                    <mat-error *ngIf="simulationStepperForm.get('step1').get('email').hasError('email')">
                                        Enter a valid email address
                                    </mat-error>
                                    <mat-error *ngIf="simulationStepperForm.get('step1').get('email').hasError('required')">
                                        Email obligatoire
                                    </mat-error>
                                </mat-form-field>

                                <!-- Nationalité -->
                                <mat-form-field class="w-full"
                                    [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                                    <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:flag'" matPrefix>
                                    </mat-icon>
                                    <mat-select [formControlName]="'nationalite'">
                                        <ng-container *ngFor="let nationalite of nationalites">
                                            <mat-option [value]="nationalite.code">
                                                {{nationalite.libelle}}
                                            </mat-option>
                                        </ng-container>
                                    </mat-select>
                                    <mat-label class="text-sm font-semibold">Nationalité
                                    </mat-label>
                                    <mat-error *ngIf="simulationStepperForm.get('step1').get('nationalite').hasError('required')">
                                        Nationalité obligatoire
                                    </mat-error>
                                </mat-form-field>

                                <!-- Birthday -->
                                <mat-form-field class="w-full"
                                    [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                                    <mat-label>Date de naissance</mat-label>
                                    <mat-icon
                                        matPrefix
                                        class="hidden sm:flex icon-size-5"
                                        [svgIcon]="'heroicons_solid:cake'"></mat-icon>
                                    <input
                                        matInput
                                        [matDatepicker]="dateNaissancePicker"
                                        [formControlName]="'dateNaissance'"
                                        [placeholder]="'Date de naissance'">
                                    <mat-datepicker-toggle
                                        matSuffix
                                        [for]="dateNaissancePicker">
                                    </mat-datepicker-toggle>
                                    <mat-datepicker #dateNaissancePicker>
                                        <mat-datepicker-actions>
                                            <button 
                                                mat-button
                                                (click)="simulationStepperForm.get('step1').get('dateNaissance').setValue(null)"
                                                matDatepickerCancel>
                                                Clear
                                            </button>
                                            <button 
                                                class=""
                                                mat-flat-button
                                                [color]="'primary'"
                                                matDatepickerApply>
                                                Select
                                            </button>
                                        </mat-datepicker-actions>
                                    </mat-datepicker>
                                </mat-form-field>

                                <!-- Résident -->
                                <mat-radio-group class="flex flex-col w-full"
                                    [color]="'primary'"
                                    [formControlName]="'residantMaroc'">
                                    <mat-label class="text-sm font-semibold">Résident au Maroc ? *</mat-label>
                                    <div class="flex flex-row mt-1.5 bg-card px-4 py-2 md:py-3 rounded-md shadow ring-1 ring-gray-300 w-full">
                                        <mat-radio-button [value]="'true'">
                                            Oui
                                        </mat-radio-button>
                                        <mat-radio-button class="ml-5" [value]="'false'">
                                            Non
                                        </mat-radio-button>
                                    </div>
                                    <mat-error *ngIf="simulationStepperForm.get('step1').get('residantMaroc').touched 
                                                    && simulationStepperForm.get('step1').get('residantMaroc').hasError('required')">
                                        Résidence est obligatoire
                                    </mat-error>
                                </mat-radio-group>

                                <!-- Agreements -->
                                <mat-checkbox class="col-span-2 text-sm mt-7 font-medium"
                                    [color]="'primary'"
                                    [formControlName]="'agreements'">
                                    <span>Je déclare avoir lu et accepter les </span>
                                    <a class="ml-1 text-primary-500 hover:underline" [routerLink]="['./']">conditions
                                        générales
                                    </a>
                                    <span> d'utilisation du site </span>
                                    <a class="ml-1 text-primary-500 hover:underline"
                                        [routerLink]="['/landing']">www.wafaimmobilier.com
                                    </a>
                                    <span>, notamment les mentions relatives à la protection des données
                                        personnelles</span>
                                </mat-checkbox>

                            </div>

                            <!-- Actions -->
                            <div class="flex justify-end mt-7">
                                <button 
                                    class="px-8"
                                    mat-flat-button
                                    [color]="'primary'"
                                    [disabled]="simulationStepperStep1.stepControl.pristine || simulationStepperStep1.stepControl.invalid"
                                    type="button" matStepperNext>
                                    Suivant
                                </button>
                            </div>

                        </mat-step>

                        <mat-step
                            [formGroupName]="'step2'"
                            [stepControl]="simulationStepperForm.get('step2')"
                            #simulationStepperStep2>
                            <ng-template matStepLabel *ngIf="!isXsScreen">Ma situation</ng-template>

                            <div class="w-full grid grid-cols-2 gap-x-2 md:mt-5">

                                <!-- Catégorie socio professionnelle -->
                                <mat-form-field class="w-full"
                                    [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                                    <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:briefcase'" matPrefix>
                                    </mat-icon>
                                    <mat-select [formControlName]="'categorieSocioProfessionnelle'">
                                        <ng-container *ngFor="let categorie of categories">
                                            <mat-option [value]="categorie.code">
                                                {{categorie.libelle}}
                                            </mat-option>
                                        </ng-container>
                                    </mat-select>
                                    <mat-label class="text-sm font-semibold">Catégorie socio-professionnelle
                                    </mat-label>
                                    <mat-error *ngIf="simulationStepperForm.get('step2').get('categorieSocioProfessionnelle').hasError('required')">
                                        Catégorie socio-professionnelle obligatoire
                                    </mat-error>
                                </mat-form-field>

                                <!-- Employeur -->
                                <mat-form-field class="w-full"
                                    [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                                    <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:office-building'" matPrefix>
                                    </mat-icon>
                                    <input matInput [formControlName]="'nomEmployeur'">
                                    <mat-label class="text-sm font-semibold">Employeur</mat-label>
                                    <mat-error *ngIf="simulationStepperForm.get('step2').get('nomEmployeur').hasError('required')">
                                        Employeur obligatoire
                                    </mat-error>
                                </mat-form-field>

                                <!-- Salaire annuel net -->
                                <mat-form-field class="w-full"
                                    [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                                    <input matInput [formControlName]="'salaire'">
                                    <mat-label class="text-sm font-semibold">Salaire annuel net</mat-label>
                                    <span matSuffix>Dhs</span>
                                    <mat-error *ngIf="simulationStepperForm.get('step2').get('salaire').hasError('required')">
                                        Salaire annuel net obligatoire
                                    </mat-error>
                                </mat-form-field>

                                <!-- Autres revenus -->
                                <mat-form-field class="w-full"
                                    [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                                    <input matInput [formControlName]="'autresRevenus'">
                                    <mat-label class="text-sm font-semibold">Autres revenus</mat-label>
                                    <span matSuffix>Dhs</span>
                                    <mat-error *ngIf="simulationStepperForm.get('step2').get('autresRevenus').hasError('required')">
                                        Autres revenus obligatoire
                                    </mat-error>
                                </mat-form-field>

                                <!-- Mensualités de vos crédits en cours -->
                                <mat-form-field class="w-full"
                                    [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                                    <input matInput [formControlName]="'creditsEnCours'">
                                    <mat-label class="text-sm font-semibold">Mensualités de vos crédits en cours</mat-label>
                                    <span matSuffix>Dhs</span>
                                    <mat-error *ngIf="simulationStepperForm.get('step2').get('creditsEnCours').hasError('required')">
                                        Mensualités de vos crédits en cours obligatoire
                                    </mat-error>
                                </mat-form-field>

                            </div>

                            <!-- Actions -->
                            <div class="flex justify-end mt-5">
                                <button class="px-8 mr-2" 
                                    mat-flat-button
                                    [color]="'accent'"
                                    type="button"
                                    matStepperPrevious>
                                    Précédent
                                </button>
                                <button class="px-8"
                                    mat-flat-button
                                    [color]="'primary'"
                                    [disabled]="simulationStepperStep2.stepControl.pristine || simulationStepperStep2.stepControl.invalid"
                                    type="button"
                                    matStepperNext>
                                    Suivant
                                </button>
                            </div>
                        </mat-step>

                        <mat-step
                            [formGroupName]="'step3'"
                            [stepControl]="simulationStepperForm.get('step3')"
                            #simulationStepperStep3>
                            <ng-template matStepLabel *ngIf="!isXsScreen">Mon projet</ng-template>

                            <div class="w-full grid grid-cols-2 gap-x-2 md:mt-5">

                                <!-- Prix du bien -->
                                <mat-form-field class="w-full"
                                    [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                                    <input matInput [formControlName]="'montant'">
                                    <mat-label class="text-sm font-semibold">Prix du bien</mat-label>
                                    <span matSuffix>Dhs</span>
                                    <mat-error *ngIf="simulationStepperForm.get('step3').get('montant').hasError('required')">
                                        Prix du bien obligatoire
                                    </mat-error>
                                </mat-form-field>

                                <!-- Objet de financement -->
                                <mat-form-field class="w-full"
                                    [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                                    <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:home'" matPrefix>
                                    </mat-icon>
                                    <mat-select [formControlName]="'objetFinancement'">
                                        <ng-container *ngFor="let objetFinancement of objetsFinancement">
                                            <mat-option [value]="objetFinancement.code">
                                                {{objetFinancement.libelle}}
                                            </mat-option>
                                        </ng-container>
                                    </mat-select>
                                    <mat-label class="text-sm font-semibold">Objet de financement
                                    </mat-label>
                                    <mat-error *ngIf="simulationStepperForm.get('step3').get('objetFinancement').hasError('required')">
                                        Objet de financement obligatoire
                                    </mat-error>
                                </mat-form-field>

                                <!-- Montant -->
                                <mat-form-field class="w-full"
                                    [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                                    <input matInput [formControlName]="'montantProposition'">
                                    <mat-label class="text-sm font-semibold">Montant</mat-label>
                                    <span matSuffix>Dhs</span>
                                    <mat-error *ngIf="simulationStepperForm.get('step3').get('montantProposition').hasError('required')">
                                        Montant obligatoire
                                    </mat-error>
                                </mat-form-field>

                                <!-- Durée -->
                                <mat-form-field class="w-full"
                                    [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                                    <input matInput [formControlName]="'duree'">
                                    <mat-label class="text-sm font-semibold">Durée (en mois)</mat-label>
                                    <span matSuffix>ans</span>
                                    <mat-error *ngIf="simulationStepperForm.get('step3').get('duree').hasError('required')">
                                        Durée obligatoire
                                    </mat-error>
                                </mat-form-field>

                                <!-- Statut projet -->
                                <mat-form-field class="w-full"
                                    [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                                    <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:lightning-bolt'" matPrefix>
                                    </mat-icon>
                                    <mat-select [formControlName]="'statutProjet'">
                                        <mat-option [value]="'active'">Recherche active</mat-option>
                                        <mat-option [value]="'passive'">Recherche passive</mat-option>
                                    </mat-select>
                                    <mat-label class="text-sm font-semibold">Statut du projet
                                    </mat-label>
                                    <mat-error *ngIf="simulationStepperForm.get('step3').get('statutProjet').hasError('required')">
                                        Statut du projet obligatoire
                                    </mat-error>
                                </mat-form-field>

                                <!-- Promoteur -->
                                <mat-form-field class="w-full"
                                    [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                                    <mat-icon class="icon-size-5" [svgIcon]="'mat_solid:real_estate_agent'" matPrefix>
                                    </mat-icon>
                                    <input matInput [formControlName]="'nomPromoteur'">
                                    <mat-label class="text-sm font-semibold">Promoteur</mat-label>
                                    <mat-error *ngIf="simulationStepperForm.get('step3').get('nomPromoteur').hasError('required')">
                                        Promoteur obligatoire
                                    </mat-error>
                                </mat-form-field>

                                <!-- Type de taux -->
                                <mat-radio-group
                                    class="flex flex-col col-span-2 w-full sm:w-fit"
                                    [color]="'primary'"
                                    [formControlName]="'typeTaux'">
                                    <mat-label class="text-sm font-semibold">Type de taux *</mat-label>
                                    <div class="flex flex-row mt-1.5 bg-card px-4 py-2 md:py-3 rounded-md shadow ring-1 ring-gray-300 w-full">
                                        <mat-radio-button [value]="'FIXE'">
                                            Valeur Fixe
                                        </mat-radio-button>
                                        <mat-radio-button class="ml-9 md:ml-7 mr-5" [value]="'VARI'">
                                            Valeur variable
                                        </mat-radio-button>
                                    </div>
                                    <mat-error *ngIf="simulationStepperForm.get('step3').get('typeTaux').touched 
                                                    && simulationStepperForm.get('step3').get('typeTaux').hasError('required')">
                                        Type de taux est obligatoire
                                    </mat-error>
                                </mat-radio-group>

                            </div>

                            <!-- Actions -->
                            <div class="flex justify-end mt-9">
                                <button
                                    class="md:px-8 mr-2 bg-default"
                                    mat-stroked-button
                                    [color]="'primary'"
                                    type="reset"
                                    (click)="newSimulation()">
                                    Refaire simulation
                                </button>
                                <button
                                    class="md:px-8 mr-2"
                                    mat-flat-button
                                    [color]="'accent'"
                                    type="button"
                                    matStepperPrevious>
                                    Précédent
                                </button>
                                <button
                                    class="md:px-8"
                                    [ngClass]="{'bg-primary-200' : simulationStepperStep3.stepControl.pristine || simulationStepperStep3.stepControl.invalid}"
                                    mat-flat-button
                                    [color]="'primary'"
                                    type="button"
                                    [disabled]="simulationStepperStep3.stepControl.pristine || simulationStepperStep3.stepControl.invalid"
                                    (click)="simuler()">
                                    Simuler
                                </button>
                            </div>
                        </mat-step>

                    </mat-horizontal-stepper>

                    <div class="flex flex-row space-x-2 mx-6 mb-3 py-2 px-4 rounded-md shadow overflow-hidden bg-amber-100">
                        <mat-icon class="icon-size-5 text-amber-500" [svgIcon]="'heroicons_solid:information-circle'">
                        </mat-icon>
                        <span class="text-xs font-semibold">« Conformément à la loi 09-08, vous disposez d'un droit d'accès, de rectification et
                            d'opposition au traitement de vos données personnelles. Ce traitement est opéré
                            conformément aux autorisations obtenues par Wafa Immobilier auprès de la CNDP »
                        </span>
                    </div>
                </form>

                <!-- Résultat -->
                <mat-drawer-container
                    *ngIf="isVisible"
                    [@fadeInBottom]="{value:!isScreenSmall, params: {duration: 1000, delay: 500}}"
                    class="bg-transparent md:w-3/5 rounded-md md:-mt-5"
                    [ngClass]="{'h-[86vh]': isScreenSmall && drawerOpened}"
                    [hasBackdrop]="true"
                    #drawerContainerResult>

                    <mat-drawer
                        class="w-full sm:w-[95%] lg:border-r lg:shadow-none dark:bg-gray-900"
                        [autoFocus]="false"
                        [(opened)]="drawerOpened"
                        #drawerTableauSD>
                        <tableau-amortissement [dossierId]="simulationResultat.dossierId" [drawer]="drawerTableauSD"></tableau-amortissement>
                    </mat-drawer>

                    <mat-drawer-content class="px-1 pt-5 pb-1">

                        <fuse-card #resultat
                            class="flex flex-col px-6 pb-8 pt-3 ring-1 ring-primary bg-default rounded-md shadow overflow-visible">
                            
                            <div class="absolute inset-x-0 -top-4 flex items-center justify-center">
                                <div class="flex items-center h-8 px-8 rounded-full font-medium text-center leading-none bg-primary text-on-primary">
                                    Votre simulation
                                </div>
                            </div>

                            <div class="flex flex-col">
                                <!-- bouton tableau amortissement -->
                                <div class="ml-auto mt-3 mb-5">
                                    <button
                                        mat-flat-button
                                        class="fuse-mat-button-small"
                                        type="button" 
                                        [color]="'accent'"
                                        (click)="openTableauAmortissement()">
                                        Tableau d'amortissement
                                    </button>
                                </div>
                                
                                <div class="flex flex-col md:flex-row max-md:space-y-10 md:space-x-4">

                                    <!-- mensualité -->
                                    <div class="md:w-2/3">
                                        <!-- header -->
                                        <div class="min-h-36 flex flex-col py-3 px-5 shadow rounded-md bg-primary-500 dark:bg-white dark:bg-opacity-5 dark:text-primary-400">

                                            <div class="flex flex-row items-center md:items-end justify-between space-x-3 text-white">
                                                <div class="flex flex-col w-3/5 border-r border-white pr-3">
                                                    <div class="text-xl md:text-2xl font-semibold leading-tight tracking-tight">Mensualités TTC</div>

                                                    <div class="flex items-baseline whitespace-nowrap md:ml-auto mt-2">
                                                        <div class="text-4xl font-bold leading-tight tracking-tight" #mensualiteId>
                                                            {{simulationResultat.mensualite | number:'1.2-2'}}
                                                        </div>
                                                        <div class="ml-2 md:text-xl leading-none">Dhs/mois</div>
                                                    </div>
                                                </div>

                                                <div class="flex flex-col w-fit">
                                                    <div class="text-lg md:text-xl font-semibold leading-none">Durée</div>
                                                    <div class="flex flex-col md:flex-row mt-2">
                                                        <div class="flex flex-row items-baseline">
                                                            <div class="font-medium text-2xl md:text-3xl leading-tight tracking-tight" #nbreAnneeId>
                                                                {{simulationResultat.nbreAnnee}}
                                                            </div>
                                                            <div class="ml-2 md:text-xl leading-none">ans</div>
                                                        </div>
                                                        <div class="flex flex-row items-baseline md:ml-2">
                                                            <div class="font-medium text-2xl md:text-3xl leading-tight tracking-tight" #nbreMoisId>
                                                                {{simulationResultat.nbreMois}}
                                                            </div>
                                                            <div class="ml-2 md:text-xl leading-none">mois</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="w-8 h-1 rounded-2xl bg-second-500 mt-2"></div>

                                            <div class="text-sm font-semibold leading-none tracking-tight text-second-500 mt-2">
                                                Cette échéance n'inclut pas les frais d'assurance
                                            </div>
                                        </div>

                                        <!-- details -->
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-3 gap-y-5 mt-7">
                                            
                                            <!-- Montant -->
                                            <div class="relative p-3 bg-card rounded-md shadow overflow-hidden">
                                                <!-- Border -->
                                                <div class="absolute left-0 top-0 bottom-0 w-1 bg-primary-500"></div>

                                                <!-- Content -->
                                                <div class="flex flex-col">
                                                    <div class="text-sm font-semibold leading-none text-secondary">
                                                        Montant crédit demandé
                                                    </div>
                                                    <div class="flex items-baseline whitespace-nowrap mt-2">
                                                        <div class="font-medium text-3xl leading-tight tracking-tight" #montantId>
                                                            {{simulationResultat.montant | number:'1.2-2'}}
                                                        </div>
                                                        <div class="ml-2 text-xl leading-none">Dhs</div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Total des intérêts -->
                                            <div class="relative p-3 bg-card rounded-md shadow overflow-hidden">
                                                <!-- Border -->
                                                <div class="absolute left-0 top-0 bottom-0 w-1 bg-primary-500"></div>

                                                <!-- Content -->
                                                <div class="flex flex-col">
                                                    <div class="text-sm font-semibold leading-none text-secondary">
                                                        Total des intérêts
                                                    </div>
                                                    <div class="flex items-baseline whitespace-nowrap mt-2">
                                                        <div class="font-medium text-3xl leading-tight tracking-tight" #totalInteretsId>
                                                            {{simulationResultat.totalInterets | number:'1.2-2'}}
                                                        </div>
                                                        <div class="ml-2 text-xl leading-none">Dhs</div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Coût total du crédit -->
                                            <div class="relative p-3 bg-card rounded-md shadow overflow-hidden">
                                                <!-- Border -->
                                                <div class="absolute left-0 top-0 bottom-0 w-1 bg-primary-500"></div>

                                                <!-- Content -->
                                                <div class="flex flex-col">
                                                    <div class="text-sm font-semibold leading-none text-secondary">
                                                        Coût total du crédit
                                                    </div>
                                                    <div class="flex items-baseline whitespace-nowrap mt-2">
                                                        <div class="font-medium text-3xl leading-tight tracking-tight" #coutTotalId>
                                                            {{simulationResultat.coutTotal | number:'1.2-2'}}
                                                        </div>
                                                        <div class="ml-2 text-xl leading-none">Dhs</div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Assurances -->
                                            <div class="relative p-3 bg-card rounded-md shadow overflow-hidden">
                                                <!-- Border -->
                                                <div class="absolute left-0 top-0 bottom-0 w-1 bg-primary-500"></div>
                    
                                                <!-- Content -->
                                                <div class="flex flex-col">
                                                    <div class="text-sm font-semibold leading-none text-secondary">
                                                        Assurances
                                                    </div>
                                                    <div class="flex items-baseline whitespace-nowrap mt-2">
                                                        <div class="font-medium text-3xl leading-tight tracking-tight" #assurancesId>
                                                            {{simulationResultat.totalInterets | number:'1.2-2'}}
                                                        </div>
                                                        <div class="ml-2 text-xl leading-none">Dhs</div>
                                                    </div>
                                                </div>
                                            </div>
                    
                                            <!-- Taux de participation -->
                                            <div class="relative p-3 bg-card rounded-md shadow overflow-hidden">
                                                <!-- Border -->
                                                <div class="absolute left-0 top-0 bottom-0 w-1 bg-primary-500"></div>
                    
                                                <!-- Content -->
                                                <div class="flex flex-col">
                                                    <div class="text-sm font-semibold leading-none text-secondary">
                                                        Taux de participation
                                                    </div>
                                                    <div class="flex items-baseline whitespace-nowrap mt-2">
                                                        <div class="font-medium text-3xl leading-tight tracking-tight" #tauxParticipationId>
                                                            {{simulationResultat.tauxParticipation | number:'1.2-2'}}
                                                        </div>
                                                        <div class="ml-2 text-xl leading-none">%</div>
                                                    </div>
                                                </div>
                                            </div>
                    
                                            <!-- TEG -->
                                            <div class="relative p-3 bg-card rounded-md shadow overflow-hidden">
                                                <!-- Border -->
                                                <div class="absolute left-0 top-0 bottom-0 w-1 bg-primary-500"></div>
                    
                                                <!-- Content -->
                                                <div class="flex flex-col">
                                                    <div class="text-sm font-semibold leading-none text-secondary">
                                                        TEG
                                                    </div>
                                                    <div class="flex items-baseline whitespace-nowrap mt-2">
                                                        <div class="font-medium text-3xl leading-tight tracking-tight" #tauxEffectifGlobalId>
                                                            {{simulationResultat.tauxEffectifGlobal | number:'1.3-3'}}
                                                        </div>
                                                        <div class="ml-2 text-xl leading-none">%</div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Expertise immobilière -->
                                            <div class="relative p-3 bg-card rounded-md shadow overflow-hidden">
                                                <!-- Border -->
                                                <div class="absolute left-0 top-0 bottom-0 w-1 bg-primary-500"></div>
                    
                                                <!-- Content -->
                                                <div class="flex flex-col">
                                                    <div class="text-sm font-semibold leading-none text-secondary">
                                                        Expertise immobilière
                                                    </div>
                                                    <!-- <div class="text-green-600 mt-2 uppercase font-medium text-3xl leading-none">
                                                        {{simulationResultat.expertiseImmobiliere}}
                                                    </div> -->
                                                    <div class="flex items-baseline whitespace-nowrap mt-2">
                                                        <div class="font-medium text-3xl leading-tight tracking-tight"
                                                            #expertiseImmobiliereId [ngClass]="{'text-green-600 ': !estExpImmoNum}">
                                                            {{simulationResultat.expertiseImmobiliere | number:'1.2-2'}}
                                                        </div>
                                                        <div class="ml-2 text-xl leading-none" [ngClass]="{'hidden': !estExpImmoNum}">Dhs</div>
                                                    </div>
                                                </div>
                                            </div>
                    
                                            <!-- Frais de dossier -->
                                            <div class="relative p-3 bg-card rounded-md shadow overflow-hidden">
                                                <!-- Border -->
                                                <div class="absolute left-0 top-0 bottom-0 w-1 bg-primary-500"></div>
                    
                                                <!-- Content -->
                                                <div class="flex flex-col">
                                                    <span class="text-sm font-semibold leading-none text-secondary">
                                                        Frais de dossier
                                                    </span>
                                                    <!-- <div class="text-green-600 mt-2 uppercase font-medium text-3xl leading-none">
                                                        {{simulationResultat.fraisDossier}}
                                                    </div> -->
                                                    <div class="flex items-baseline whitespace-nowrap mt-2">
                                                        <div class="font-medium text-3xl leading-tight tracking-tight" #fraisDossierId
                                                            [ngClass]="{'text-green-600 ': !estFraisDossNum}">
                                                            {{simulationResultat.fraisDossier | number:'1.2-2'}}
                                                        </div>
                                                        <div class="ml-2 text-xl leading-none" [ngClass]="{'hidden': !estFraisDossNum}">Dhs</div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>

                                    <!-- frais annexes -->
                                    <div class="w-full md:w-1/3">

                                        <!-- header -->
                                        <div class="min-h-36 flex flex-col py-3 px-5 rounded-md shadow bg-primary-150 dark:bg-white dark:bg-opacity-5 dark:text-primary-400">

                                            <div class="flex flex-col text-primary-600">
                                                <div class="text-2xl font-semibold leading-tight tracking-tight">
                                                    Frais annexes
                                                </div>

                                                <div class="flex items-baseline whitespace-nowrap md:ml-auto mt-2">
                                                    <div class="text-4xl font-bold leading-tight tracking-tight" #totalFraisId>
                                                        {{simulationResultat.totalFrais | number:'1.2-2'}}
                                                    </div>
                                                    <div class="ml-2 text-xl leading-none">Dhs</div>
                                                </div>
                                            </div>

                                            <div class="w-8 h-1 rounded-2xl bg-amber-600 mt-2"></div>

                                            <div class="text-sm font-semibold leading-none tracking-tight text-amber-600 mt-2">
                                                Ces montants sont à titre indicatifs et ne sont aucunement contractuels
                                            </div>
                                        </div>

                                        <!-- details -->
                                        <div class="grid grid-cols-1 gap-y-5 mt-7">

                                            <!-- Enregistrement hypothécaire -->
                                            <div class="relative p-3 bg-card rounded-md shadow overflow-hidden">
                                                <!-- Border -->
                                                <div class="absolute left-0 top-0 bottom-0 w-1 bg-primary-500"></div>
                    
                                                <!-- Content -->
                                                <div class="flex flex-col">
                                                    <div class="text-sm font-medium leading-none text-secondary">
                                                        Enregistrement hypothécaire
                                                    </div>
                                                    <div class="flex items-baseline whitespace-nowrap mt-2">
                                                        <div class="font-medium text-3xl leading-tight tracking-tight" #droitsEnregistrementId>
                                                            {{simulationResultat.droitsEnregistrement | number:'1.2-2'}}
                                                        </div>
                                                        <div class="ml-2 text-xl leading-none">Dhs</div>
                                                    </div>
                                                </div>
                                            </div>
                    
                                            <!-- Conservation foncière -->
                                            <div class="relative p-3 bg-card rounded-md shadow overflow-hidden">
                                                <!-- Border -->
                                                <div class="absolute left-0 top-0 bottom-0 w-1 bg-primary-500"></div>
                    
                                                <!-- Content -->
                                                <div class="flex flex-col">
                                                    <div class="text-sm font-medium leading-none text-secondary">
                                                        Conservation foncière
                                                    </div>
                                                    <div class="flex items-baseline whitespace-nowrap mt-2">
                                                        <div class="font-medium text-3xl leading-tight tracking-tight" #conservationFonciereId>
                                                            {{simulationResultat.conservationFonciere | number:'1.2-2'}}
                                                        </div>
                                                        <div class="ml-2 text-xl leading-none">Dhs</div>
                                                    </div>
                                                </div>
                                            </div>
                    
                                            <!-- Frais de dossier notaire -->
                                            <div class="relative p-3 bg-card rounded-md shadow overflow-hidden">
                                                <!-- Border -->
                                                <div class="absolute left-0 top-0 bottom-0 w-1 bg-primary-500"></div>
                    
                                                <!-- Content -->
                                                <div class="flex flex-col">
                                                    <div class="text-sm font-medium leading-none text-secondary">
                                                        Frais de dossier notaire
                                                    </div>
                                                    <div class="flex items-baseline whitespace-nowrap mt-2">
                                                        <div class="font-medium text-3xl leading-tight tracking-tight" #fraisDiversId>
                                                            {{simulationResultat.fraisDivers | number:'1.2-2'}}
                                                        </div>
                                                        <div class="ml-2 text-xl leading-none">Dhs</div>
                                                    </div>
                                                </div>
                                            </div>
                    
                                            <!-- Honoraires de notaire -->
                                            <div class="relative p-3 bg-card rounded-md shadow overflow-hidden">
                                                <!-- Border -->
                                                <div class="absolute left-0 top-0 bottom-0 w-1 bg-primary-500"></div>
                    
                                                <!-- Content -->
                                                <div class="flex flex-col">
                                                    <div class="text-sm font-medium leading-none text-secondary">
                                                        Honoraires de notaire
                                                    </div>
                                                    <div class="flex items-baseline whitespace-nowrap mt-2">
                                                        <div class="font-medium text-3xl leading-tight tracking-tight" #honorairesNotaireId>
                                                            {{simulationResultat.honorairesNotaire | number:'1.2-2'}}
                                                        </div>
                                                        <div class="ml-2 text-xl leading-none">Dhs</div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>

                                </div>
                            </div>

                            <!-- Actions -->
                            <div class="flex flex-col md:flex-row space-y-2 items-center justify-center mt-5">
                                <button
                                    class="max-md:w-full bg-gray-200"
                                    mat-stroked-button
                                    type="button" 
                                    [routerLink]="['/espace-connected']">
                                    Poursuivre plus tard
                                </button>
                                <button 
                                    class="max-md:w-full md:ml-2 bg-gray-200"
                                    mat-stroked-button
                                    type="button"
                                    [color]="'warn'">
                                    J'abandonne ma simulation
                                </button>
                                <button 
                                    class="max-md:w-full md:ml-2"
                                    mat-flat-button
                                    type="button"
                                    [color]="'primary'"
                                    (click)="navigateToDemandeCredit()">
                                    Je demande un crédit
                                </button>
                            </div>

                        </fuse-card>

                    </mat-drawer-content>

                </mat-drawer-container>

            </div>

        </div>

    </div>

</div>