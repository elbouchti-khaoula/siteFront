<!-- <div class="flex flex-col flex-auto min-w-0 overflow-hidden" [@fadeInRight]="{value:'', params: {duration: 700}}"> -->
<div class="absolute inset-0 flex flex-col min-w-0 overflow-y-auto scroll-smooth" [@fadeInRight]="{value:'', params: {duration: 700}}" cdkScrollable>

    <!-- Header -->
    <header class="hidden md:flex flex-col items-center justify-center px-16 w-full min-h-[30vh] simul-det-bg-header">
        <div class="w-full max-w-400">
            <div class="max-w-xl text-2xl md:text-3xl font-bold uppercase tracking-tight leading-tight text-white">
                Bienvenur Mr LAMDA Beta
            </div>
            <div class="max-w-xl hidden md:block text-2xl text-white mt-3">
                Prenez quelques minutes pour décrire votre projet
            </div>
        </div>
    </header>

    <div class="px-5 sm:px-16 max-md:py-10 md:pb-20 simul-det-bg-header-sm">

        <div class="w-full max-w-400 mx-auto">

            <span class="md:hidden text-2xl md:text-4xl uppercase font-extrabold leading-tight tracking-tight text-primary">
                Je demande mon crédit
            </span>

            <fuse-card class="mx-auto hidden md:flex w-fit flex flex-row items-center -mt-12 h-24 shadow-md">
                <div class="relative w-68 h-full flex items-center justify-center overflow-hidden">
                    <div class="absolute bottom-0 right-0 w-18 h-18 -m-5">
                        <mat-icon
                            class="icon-size-18 opacity-25 text-green-500 dark:text-green-400"
                            [svgIcon]="'heroicons_outline:check-circle'"></mat-icon>
                    </div>
                    <span class="text-lg font-semibold">Je simule mon crédit</span>
                </div>
                <div class="relative w-88 h-full flex items-center justify-center border-l overflow-hidden">
                    <div class="absolute bottom-0 right-0 w-18 h-18 -m-5">
                        <mat-icon
                            class="icon-size-18 opacity-25 text-green-500 dark:text-green-400"
                            [svgIcon]="'heroicons_outline:check-circle'"></mat-icon>
                    </div>
                    <span class="text-lg font-semibold">Je personnalise ma simulation</span>
                </div>
                <div class="w-72 h-full flex items-center justify-center bg-primary">
                    <span class="text-lg font-semibold text-white">Je demande mon crédit</span>
                </div>
            </fuse-card>

            <div class="flex flex-col md:flex-row md:items-start max-md:space-y-14 md:space-x-7 mt-10 md:mt-14">

                <!-- Résultat -->
                <mat-drawer-container
                    class="bg-transparent md:w-[45%] rounded-md md:-mt-5"
                    [hasBackdrop]="true"
                    #drawerContainerResult>

                    <mat-drawer
                        class="w-full sm:w-[95%] lg:border-r lg:shadow-none dark:bg-gray-900"
                        [autoFocus]="false"
                        [(opened)]="drawerOpened"
                        #drawerTableauDC>
                        <tableau-amortissement [dossierId]="recapitulatif.dossierId" [drawer]="drawerTableauDC"></tableau-amortissement>
                    </mat-drawer>

                    <mat-drawer-content class="px-1 pt-5 pb-1">

                        <fuse-card #resultat
                            class="flex flex-col px-6 pb-8 pt-3 ring-1 ring-primary bg-default rounded-md shadow overflow-visible md:min-h-[75vh]">
                            
                            <div class="absolute inset-x-0 -top-4 flex items-center justify-center">
                                <div class="flex items-center h-8 px-8 rounded-full font-medium text-center leading-none bg-primary text-on-primary">
                                    Récapitulatif
                                </div>
                            </div>

                            <div class="flex flex-col space-y-5">
                                <!-- bouton tableau amortissement -->
                                <div class="ml-auto mt-3">
                                    <button
                                        mat-flat-button
                                        class="fuse-mat-button-small"
                                        type="button" 
                                        [color]="'accent'"
                                        (click)="openTableauAmortissement()">
                                        Tableau d'amortissement
                                    </button>
                                </div>

                                <fuse-card class="flex flex-col px-8 py-5 rounded-md shadow"
                                    #fuseCardProfil
                                    [expanded]="true">
                                    <div class="flex flex-row items-center">
                                        <button
                                            class="min-w-10 min-h-7 h-7 px-2 leading-6 bg-primary-500"
                                            mat-stroked-button
                                            (click)="fuseCardProfil.expanded = !fuseCardProfil.expanded">
                                            <mat-icon
                                                class="icon-size-5 text-white"
                                                *ngIf="!fuseCardProfil.expanded"
                                                [svgIcon]="'heroicons_solid:chevron-down'"></mat-icon>
                                            <mat-icon
                                                class="icon-size-5 text-white"
                                                *ngIf="fuseCardProfil.expanded"
                                                [svgIcon]="'heroicons_solid:chevron-up'"></mat-icon>
                                        </button>
                                        <div class="ml-5 text-lg font-bold">Mon profil</div>
                                    </div>

                                    <!-- Expansion -->
                                    <ng-container fuseCardExpansion>
                                        <div class="grid grid-cols-2 gap-x-3 gap-y-5 mt-5 p-5 ring-1 ring-second rounded-md bg-second-50">
                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Nom
                                                </div>
                                                <div class="font-medium text-xl leading-tight tracking-tight mt-2">
                                                    {{recapitulatif?.nom}}
                                                </div>
                                            </div>
                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Prénom
                                                </div>
                                                <div class="font-medium text-xl leading-tight tracking-tight mt-2">
                                                    {{recapitulatif?.prenom}}
                                                </div>
                                            </div>
                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Téléphone
                                                </div>
                                                <div class="font-medium text-xl leading-tight tracking-tight mt-2">
                                                    {{recapitulatif?.telephone}}
                                                </div>
                                            </div>
                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Email
                                                </div>
                                                <div class="font-medium text-xl leading-tight tracking-tight mt-2">
                                                    {{recapitulatif?.email}}
                                                </div>
                                            </div>
                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Date de naissance
                                                </div>
                                                <div class="font-medium text-xl leading-tight tracking-tight mt-2">
                                                    {{recapitulatif?.dateNaissance}}
                                                </div>
                                            </div>
                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Nationalite
                                                </div>
                                                <div class="font-medium text-xl leading-tight tracking-tight mt-2">
                                                    {{recapitulatif?.nationalite}}
                                                </div>
                                            </div>
                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Résidant au maroc
                                                </div>
                                                <div class="font-medium text-xl leading-tight tracking-tight mt-2">
                                                    {{recapitulatif?.residantMaroc}}
                                                </div>
                                            </div>
                                        </div>

                                    </ng-container>
                                </fuse-card>

                                <fuse-card class="flex flex-col px-8 py-3 pb-4 rounded-md shadow" #fuseCardSituation>
                                    <div class="flex flex-row items-center">
                                        <button
                                            class="min-w-10 min-h-7 h-7 px-2 leading-6 bg-primary-500"
                                            mat-stroked-button
                                            (click)="fuseCardSituation.expanded = !fuseCardSituation.expanded">
                                            <mat-icon
                                                class="icon-size-5 text-white"
                                                *ngIf="!fuseCardSituation.expanded"
                                                [svgIcon]="'heroicons_solid:chevron-down'"></mat-icon>
                                            <mat-icon
                                                class="icon-size-5 text-white"
                                                *ngIf="fuseCardSituation.expanded"
                                                [svgIcon]="'heroicons_solid:chevron-up'"></mat-icon>
                                        </button>
                                        <div class="ml-5 text-lg font-bold">Ma situation</div>
                                    </div>

                                    <!-- Expansion -->
                                    <ng-container fuseCardExpansion>
                                        <div class="grid grid-cols-2 gap-x-3 gap-y-5 mt-5 p-5 ring-1 ring-second rounded-md bg-second-50">
                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Categorie Socio Professionnelle
                                                </div>
                                                <div class="font-medium text-xl leading-tight tracking-tight mt-2">
                                                    {{recapitulatif?.categorieSocioProfessionnelle}}
                                                </div>
                                            </div>
                                             <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Employeur
                                                </div>
                                                <div class="font-medium text-xl leading-tight tracking-tight mt-2">
                                                    {{recapitulatif?.nomEmployeur}}
                                                </div>
                                            </div>
                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Salaire
                                                </div>
                                                <div class="font-medium text-xl leading-tight tracking-tight mt-2">
                                                    {{recapitulatif?.salaire}}
                                                </div>
                                            </div>
                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Autres revenus
                                                </div>
                                                <div class="font-medium text-xl leading-tight tracking-tight mt-2">
                                                    {{recapitulatif?.autresRevenus}}
                                                </div>
                                            </div>
                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Montant des crédits en cours
                                                </div>
                                                <div class="font-medium text-xl leading-tight tracking-tight mt-2">
                                                    {{recapitulatif?.creditsEnCours}}
                                                </div>
                                            </div>
                                        </div>
                                    </ng-container>
                                </fuse-card>

                                <fuse-card class="flex flex-col px-8 py-3 pb-4 rounded-md shadow" #fuseCardProjet>
                                    <div class="flex flex-row items-center">
                                        <button
                                            class="min-w-10 min-h-7 h-7 px-2 leading-6 bg-primary-500"
                                            mat-stroked-button
                                            (click)="fuseCardProjet.expanded = !fuseCardProjet.expanded">
                                            <mat-icon
                                                class="icon-size-5 text-white"
                                                *ngIf="!fuseCardProjet.expanded"
                                                [svgIcon]="'heroicons_solid:chevron-down'"></mat-icon>
                                            <mat-icon
                                                class="icon-size-5 text-white"
                                                *ngIf="fuseCardProjet.expanded"
                                                [svgIcon]="'heroicons_solid:chevron-up'"></mat-icon>
                                        </button>
                                        <div class="ml-5 text-lg font-bold">Mon projet</div>
                                    </div>

                                    <!-- Expansion -->
                                    <ng-container fuseCardExpansion>
                                        <div class="grid grid-cols-2 gap-x-3 gap-y-5 mt-5 p-5 ring-1 ring-second rounded-md bg-second-50">
                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Prix du bien
                                                </div>
                                                <div class="font-medium text-xl leading-tight tracking-tight mt-2">
                                                    {{recapitulatif?.montant}}
                                                </div>
                                            </div>
                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Objet de financement
                                                </div>
                                                <div class="font-medium text-xl leading-tight tracking-tight mt-2">
                                                    {{recapitulatif?.objetFinancement}}
                                                </div>
                                            </div>
                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Montant
                                                </div>
                                                <div class="font-medium text-xl leading-tight tracking-tight mt-2">
                                                    {{recapitulatif?.montantProposition}}
                                                </div>
                                            </div>
                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    duree
                                                </div>
                                                <div class="font-medium text-xl leading-tight tracking-tight mt-2">
                                                    {{recapitulatif?.duree}}
                                                </div>
                                            </div>
                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Promoteur
                                                </div>
                                                <div class="font-medium text-xl leading-tight tracking-tight mt-2">
                                                    {{recapitulatif?.nomPromoteur}}
                                                </div>
                                            </div>
                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Statut du projet
                                                </div>
                                                <div class="font-medium text-xl leading-tight tracking-tight mt-2">
                                                    {{recapitulatif?.statutProjet}}
                                                </div>
                                            </div>
                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    type de taux
                                                </div>
                                                <div class="font-medium text-xl leading-tight tracking-tight mt-2">
                                                    {{recapitulatif?.typeTaux}}
                                                </div>
                                            </div>
                                        </div>
                                    </ng-container>
                                </fuse-card>

                                <fuse-card class="flex flex-col px-8 py-3 pb-4 rounded-md shadow" #fuseCardResultat>
                                    <div class="flex flex-row items-center">
                                        <button
                                            class="min-w-10 min-h-7 h-7 px-2 leading-6 bg-primary-500"
                                            mat-stroked-button
                                            (click)="fuseCardResultat.expanded = !fuseCardResultat.expanded">
                                            <mat-icon
                                                class="icon-size-5 text-white"
                                                *ngIf="!fuseCardResultat.expanded"
                                                [svgIcon]="'heroicons_solid:chevron-down'"></mat-icon>
                                            <mat-icon
                                                class="icon-size-5 text-white"
                                                *ngIf="fuseCardResultat.expanded"
                                                [svgIcon]="'heroicons_solid:chevron-up'"></mat-icon>
                                        </button>
                                        <div class="ml-5 text-lg font-bold">Ma simulation</div>
                                    </div>

                                    <!-- Expansion -->
                                    <ng-container fuseCardExpansion>
                                        <div class="grid grid-cols-2 gap-x-3 gap-y-5 mt-5 p-5 ring-1 ring-second rounded-md bg-second-50">

                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Montant crédit demandé
                                                </div>
                                                <div class="flex items-baseline whitespace-nowrap mt-2">
                                                    <div class="font-medium text-xl leading-tight tracking-tight" #montantId>
                                                        {{recapitulatif?.montant | number:'1.2-2'}}
                                                    </div>
                                                    <div class="ml-2 text-md leading-none">Dhs</div>
                                                </div>
                                            </div>

                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Total des intérêts
                                                </div>
                                                <div class="flex items-baseline whitespace-nowrap mt-2">
                                                    <div class="font-medium text-xl leading-tight tracking-tight" #totalInteretsId>
                                                        {{recapitulatif?.totalInterets | number:'1.2-2'}}
                                                    </div>
                                                    <div class="ml-2 text-md leading-none">Dhs</div>
                                                </div>
                                            </div>

                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Coût total du crédit
                                                </div>
                                                <div class="flex items-baseline whitespace-nowrap mt-2">
                                                    <div class="font-medium text-xl leading-tight tracking-tight" #coutTotalId>
                                                        {{recapitulatif?.coutTotal | number:'1.2-2'}}
                                                    </div>
                                                    <div class="ml-2 text-md leading-none">Dhs</div>
                                                </div>
                                            </div>

                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Assurances
                                                </div>
                                                <div class="flex items-baseline whitespace-nowrap mt-2">
                                                    <div class="font-medium text-xl leading-tight tracking-tight" #assurancesId>
                                                        {{recapitulatif?.totalInterets | number:'1.2-2'}}
                                                    </div>
                                                    <div class="ml-2 text-md leading-none">Dhs</div>
                                                </div>
                                            </div>

                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Taux de participation
                                                </div>
                                                <div class="flex items-baseline whitespace-nowrap mt-2">
                                                    <div class="font-medium text-xl leading-tight tracking-tight" #tauxParticipationId>
                                                        {{recapitulatif?.tauxParticipation | number:'1.2-2'}}
                                                    </div>
                                                    <div class="ml-2 text-md leading-none">%</div>
                                                </div>
                                            </div>

                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    TEG
                                                </div>
                                                <div class="flex items-baseline whitespace-nowrap mt-2">
                                                    <div class="font-medium text-xl leading-tight tracking-tight" #tauxEffectifGlobalId>
                                                        {{recapitulatif?.tauxEffectifGlobal | number:'1.3-3'}}
                                                    </div>
                                                    <div class="ml-2 text-md leading-none">%</div>
                                                </div>
                                            </div>

                                            <div class="flex flex-col">
                                                <div class="text-sm font-semibold leading-none text-secondary">
                                                    Expertise immobilière
                                                </div>
                                                <div class="flex items-baseline whitespace-nowrap mt-2">
                                                    <div class="font-medium text-xl leading-tight tracking-tight"
                                                        #expertiseImmobiliereId [ngClass]="{'text-green-600 ': !estExpImmoNum}">
                                                        {{recapitulatif?.expertiseImmobiliere | number:'1.2-2'}}
                                                    </div>
                                                    <div class="ml-2 text-md leading-none" [ngClass]="{'hidden': !estExpImmoNum}">Dhs</div>
                                                </div>
                                            </div>

                                            <div class="flex flex-col">
                                                <span class="text-sm font-semibold leading-none text-secondary">
                                                    Frais de dossier
                                                </span>
                                                <div class="flex items-baseline whitespace-nowrap mt-2">
                                                    <div class="font-medium text-xl leading-tight tracking-tight" #fraisDossierId
                                                        [ngClass]="{'text-green-600 ': !estFraisDossNum}">
                                                        {{recapitulatif?.fraisDossier | number:'1.2-2'}}
                                                    </div>
                                                    <div class="ml-2 text-lg leading-none" [ngClass]="{'hidden': !estFraisDossNum}">Dhs</div>
                                                </div>
                                            </div>

                                            <div class="flex flex-row items-center col-span-2 border-t pt-3">
                                                <span class="text-md font-bold leading-none">
                                                    Mensualités
                                                </span>
                                                <div class="ml-auto flex items-baseline whitespace-nowrap">
                                                    <div class="text-2xl font-bold leading-tight tracking-tight">
                                                        {{recapitulatif?.mensualite | number:'1.2-2'}}
                                                    </div>
                                                    <div class="ml-2 md:text-xl leading-none">Dhs/mois</div>
                                                </div>
                                            </div>
                                        </div>

                                    </ng-container>
                                </fuse-card>
                            </div>
                        </fuse-card>

                    </mat-drawer-content>

                </mat-drawer-container>


                <form class="w-full md:w-[55%] bg-card shadow rounded-md overflow-hidden ring-1 ring-current p-6"
                    [formGroup]="demandeForm">

                    <div class="text-2xl font-semibold mb-3">Veuillez charger les fichiers ci-dessous : </div>

                    <ng-container *ngIf="pieces && pieces.length > 0">
                        <div class="flex flex-col col-span-2 mb-3 p-3 bg-gray-50 border border border-gray-300 shadow-sm rounded-md">
                            <ng-container *ngFor="let piece of pieces; let i = index; trackBy: trackByFn">
                                <div class="flex flex-row items-center justify-between">
                                    <span class="font-medium w-1/2">
                                        {{piece.libelle}} :
                                    </span>
                                    <span class="text-sm text-primary">
                                        {{piece.fileName}}
                                    </span>
                                    <!-- file -->
                                    <div>
                                        <input
                                            id="{{ 'file-input' + i }}"
                                            class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                            type="file"
                                            [multiple]="false"
                                            [accept]="'image/jpeg, image/png'"
                                            (change)="uploadPiece(piece, $event.target.files)"
                                            #fileInput>
                                        <button
                                            *ngIf="piece.file"
                                            class="flex items-center justify-center w-10 h-10 rounded-full hover:bg-gray-400 hover:bg-opacity-20 dark:hover:bg-black dark:hover:bg-opacity-5"
                                            mat-icon-button
                                            (click)="deletePiece(piece, i)">
                                            <mat-icon [svgIcon]="'heroicons_outline:x'"></mat-icon>
                                        </button>
                                        <label
                                            *ngIf="!piece.file"
                                            class="flex items-center justify-center w-10 h-10 rounded-full cursor-pointer hover:bg-gray-400 hover:bg-opacity-20 dark:hover:bg-black dark:hover:bg-opacity-5"
                                            for="{{ 'file-input' + i }}"
                                            matRipple>
                                            <mat-icon [svgIcon]="'heroicons_outline:photograph'"></mat-icon>
                                        </label>
                                    </div>
                                </div>
                            </ng-container>
                        </div>
                    </ng-container>

                    <!-- Actions -->
                    <div class="flex items-center">
                        <button
                            mat-flat-button
                            type="button" 
                            [color]="'primary'"
                            (click)="openChangerAgenceDialog()">
                            Changer d'agence
                        </button>
                        <!-- (click)="clearForm()" -->
                        <button mat-button
                            class="ml-auto px-8 mr-2"
                            [color]="'accent'"
                            type="button"
                            [disabled]="demandeForm.pristine || demandeForm.untouched"
                            >
                            Vider
                        </button>
                        <!-- (click)="sendForm()" -->
                        <button
                            mat-flat-button
                            class="px-8"
                            [ngClass]="{'bg-primary-200' : demandeForm.pristine || demandeForm.invalid}"
                            [color]="'primary'"
                            type="button"
                            [disabled]="demandeForm.pristine || demandeForm.invalid"
                            >
                            Valider
                        </button>
                    </div>

                </form>

            </div>

        </div>

    </div>

</div>