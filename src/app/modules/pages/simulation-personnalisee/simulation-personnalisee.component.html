<div class="flex flex-col flex-auto min-w-0 overflow-hidden" [@fadeInRight]="{value:'', params: {duration: 700}}">

    <!-- Header -->
    <page-header-connecte
        [headerStyle]="'simul-bg-header'"
        [headerLibelle]="'Simulation personnalisée'"
        [hideSmallScreen]="'true'">
    </page-header-connecte>

    <div class="px-5 sm:px-16 max-md:py-10 md:pb-20 simul-bg-header-sm">

        <div class="w-full max-w-400 mx-auto">
            
            <span class="md:hidden text-2xl uppercase font-extrabold leading-tight tracking-tight text-primary">
                Simulation personnalisée
            </span>

            <fuse-card class="mx-auto hidden md:flex flex-row items-center justify-evenly max-w-4xl mt-7 h-22 shadow-md">
                <div class="flex flex-row items-center justify-start w-52">
                    <div class="flex items-center justify-center w-16 h-16 rounded-full overflow-hidden bg-primary-500">
                        <span class="text-7xl font-bold text-white">1</span>
                    </div>
                    <div class="flex flex-col items-start ml-5 text-primary-500">
                        <span class="text-lg font-semibold">Simuler</span>
                        <span class="text-lg font-semibold">mon crédit</span>
                    </div>
                </div>

                <div class="flex flex-row items-center justify-start w-52">
                    <div class="flex items-center justify-center w-16 h-16 rounded-full overflow-hidden ring-1 ring-gray-500">
                        <span class="text-7xl font-bold text-gray-500">2</span>
                    </div>
                    <div class="flex flex-col items-start ml-5">
                        <span class="text-lg">Personnaliser</span>
                        <span class="text-lg">ma simulation</span>
                    </div>
                </div>

                <div class="flex flex-row items-center justify-start w-52">
                    <div class="flex items-center justify-center w-16 h-16 rounded-full overflow-hidden ring-1 ring-gray-500">
                        <span class="text-7xl font-bold text-gray-500">3</span>
                    </div>
                    <div class="flex flex-col items-start ml-5">
                        <span class="text-lg">Demander</span>
                        <span class="text-lg">mon crédit</span>
                    </div>
                </div>
            </fuse-card>

            <div class="flex flex-col md:flex-row md:items-start max-md:space-y-14 md:space-x-7 mt-7 md:mt-10">

                <form class="flex flex-col items-center space-y-5 px-6 pt-7 pb-5 ring-1 ring-current bg-card rounded-xl overflow-hidden"
                    [formGroup]="simulationForm"
                    [@resize]="!isScreenSmall && animationState">

                    <div class="flex flex-row bg-gray-300 rounded-md shadow py-2 px-3">
                        <mat-icon class="icon-size-5 text-warn-600" [svgIcon]="'heroicons_outline:exclamation'">
                        </mat-icon>
                        <span class="ml-2 font-semibold">Si vous êtes client Attijariwafa bank, veuillez vous connectez à l'application Attijari Mobile pour avoir de meilleurs conditions.
                        </span>
                    </div>

                    <div class="w-full mt-7">
                        <div class="text-xl md:text-2xl font-bold text-primary">
                            Mon projet
                        </div>
                        <div class="w-8 h-1 rounded-2xl mt-2 bg-second-500"></div>
                    </div>

                    <div class="w-full grid grid-cols-1 md:grid-cols-6 gap-x-2 items-start">
                        
                        <!-- Montant -->
                        <mat-form-field class="md:col-span-3 w-full"
                            [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                            <mat-icon class="icon-size-5" [svgIcon]="'mat_solid:money'" matPrefix></mat-icon>
                            <input matInput [formControlName]="'montant'" [appFormatMontant]="simulationForm.get('montant').value">
                            <mat-label class="max-md:text-sm max-md:font-semibold">Montant</mat-label>
                            <span matSuffix>MAD</span>
                            <mat-error *ngIf="simulationForm.get('montant').hasError('required')">
                                Montant obligatoire
                            </mat-error>
                        </mat-form-field>

                        <!-- Durée -->
                        <mat-form-field class="md:col-span-3 w-full"
                            [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                            <mat-icon class="icon-size-5" [svgIcon]="'mat_solid:timelapse'" matPrefix>
                            </mat-icon>
                            <input matInput [formControlName]="'duree'" [appFormatEntier]="simulationForm.get('duree').value">
                            <mat-label class="max-md:text-sm max-md:font-semibold">Durée (en mois)</mat-label>
                            <span matSuffix>mois</span>
                            <mat-error *ngIf="simulationForm.get('duree').hasError('required')">
                                Durée obligatoire
                            </mat-error>
                        </mat-form-field>

                        <div class="md:col-span-6 mb-5">
                            <div class="text-xl md:text-2xl font-bold text-primary">
                                Mon profil
                            </div>
                            <div class="w-8 h-1 rounded-2xl mt-2 bg-second-500"></div>
                        </div>

                        <!-- Nom -->
                        <mat-form-field class="md:col-span-2 w-full"
                            [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:user'" matPrefix>
                            </mat-icon>
                            <input matInput [formControlName]="'nom'">
                            <mat-label class="max-md:text-sm max-md:font-semibold">Nom</mat-label>
                            <mat-error *ngIf="simulationForm.get('nom').hasError('required')">
                                Nom obligatoire
                            </mat-error>
                        </mat-form-field>

                        <!-- Prénom -->
                        <mat-form-field class="md:col-span-2 w-full"
                            [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:user'" matPrefix>
                            </mat-icon>
                            <input matInput [formControlName]="'prenom'">
                            <mat-label class="max-md:text-sm max-md:font-semibold">Prénom</mat-label>
                            <mat-error *ngIf="simulationForm.get('prenom').hasError('required')">
                                Prénom obligatoire
                            </mat-error>
                        </mat-form-field>

                        <!-- Téléphone -->
                        <mat-form-field class="md:col-span-2 w-full"
                            [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:phone'" matPrefix>
                            </mat-icon>
                            <input matInput [formControlName]="'telephone'" appFormatTelephone>
                            <mat-label class="max-md:text-sm max-md:font-semibold">Téléphone</mat-label>
                            <mat-error *ngIf="simulationForm.get('telephone').hasError('required')">
                                Téléphone obligatoire
                            </mat-error>
                        </mat-form-field>

                        <!-- Email -->
                        <mat-form-field class="md:col-span-2 w-full" [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:mail'" matPrefix></mat-icon>
                            <input type="email" matInput [formControlName]="'email'">
                            <mat-label class="max-md:text-sm max-md:font-semibold">E-mail</mat-label>
                            <mat-error *ngIf="simulationForm.get('email').hasError('email')">
                                Veuillez saisir une adresse mail valide
                            </mat-error>
                            <mat-error *ngIf="simulationForm.get('email').hasError('required')">
                                Adresse mail obligatoire
                            </mat-error>
                        </mat-form-field>

                        <!-- Catégorie socio-professionnelle -->
                        <mat-form-field class="md:col-span-2 w-full"
                            [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:briefcase'" matPrefix>
                            </mat-icon>
                            <mat-select [formControlName]="'cspCode'">
                                <ng-container *ngFor="let categorie of categories">
                                    <mat-option [value]="categorie.code">
                                        {{categorie.libelle}}
                                    </mat-option>
                                </ng-container>
                            </mat-select>
                            <mat-label class="max-md:text-sm max-md:font-semibold">Socio-professionnelle</mat-label>
                            <mat-error *ngIf="simulationForm.get('cspCode').hasError('required')">
                                Catégorie socio-professionnelle obligatoire
                            </mat-error>
                        </mat-form-field>

                        <!-- Nationalité -->
                        <mat-form-field class="md:col-span-2 w-full"
                            [ngClass]="{'fuse-mat-dense': isScreenSmall}">
                            <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:flag'" matPrefix>
                            </mat-icon>
                            <mat-select [formControlName]="'nationaliteCode'">
                                <ng-container *ngFor="let nationalite of nationalites">
                                    <mat-option [value]="nationalite.code">
                                        {{nationalite.libelle}}
                                    </mat-option>
                                </ng-container>
                            </mat-select>
                            <mat-label class="max-md:text-sm max-md:font-semibold">Nationalité</mat-label>
                            <mat-error *ngIf="simulationForm.get('nationaliteCode').hasError('required')">
                                Nationalité obligatoire
                            </mat-error>
                        </mat-form-field>

                        <!-- Résident -->
                        <mat-radio-group class="flex flex-col md:col-span-2 w-full"
                            [color]="'primary'"
                            [formControlName]="'residentMarocain'">
                            <mat-label class="max-md:text-sm max-md:font-semibold">Résident au Maroc ? *</mat-label>
                            <div class="flex flex-row mt-1.5 bg-card px-4 py-2 md:py-3 rounded-md shadow ring-1 ring-gray-300 w-full">
                                <mat-radio-button [value]="'true'">
                                    Oui
                                </mat-radio-button>
                                <mat-radio-button class="ml-5" [value]="'false'">
                                    Non
                                </mat-radio-button>
                            </div>
                            <mat-error *ngIf="simulationForm.get('residentMarocain').touched 
                                            && simulationForm.get('residentMarocain').hasError('required')">
                                Résidence est obligatoire
                            </mat-error>
                        </mat-radio-group>

                        <!-- Agreements -->
                        <mat-checkbox class="md:col-span-6 text-sm mt-5 font-medium" [color]="'primary'"
                            [formControlName]="'agreements'">
                            <span>Je déclare avoir lu et accepter les </span>
                            <a class="ml-1 text-primary-500 hover:underline" [routerLink]="['./']">conditions générales
                            </a>
                            <span> d'utilisation du site </span>
                            <a class="ml-1 text-primary-500 hover:underline"
                                [routerLink]="['/landing']">www.wafaimmobilier.com
                            </a>
                            <span>, notamment les mentions relatives à la protection des données
                                personnelles</span>
                        </mat-checkbox>
                    </div>
                    
                    <div class="flex justify-center mt-9">
                        <app-captcha (captchaValid)="isCaptchaValid = $event"></app-captcha>
                    </div>
                    
                    <!-- Actions -->
                    <div class="w-full flex justify-end">
                        <button 
                          mat-stroked-button
                          class="bg-default"
                          type="button"
                          [color]="'primary'"
                          [disabled]="simulationForm.pristine"
                          (click)="newSimulation()">
                          Refaire ma simulation
                        </button>
                        <button
                          mat-flat-button    
                          class="ml-2 md:px-12"
                          [ngClass]="{'bg-primary-200' : simulationForm.pristine || simulationForm.invalid}"
                          type="button"
                          [color]="'primary'"
                          [disabled]="simulationForm.pristine || simulationForm.invalid || !isCaptchaValid"
                          (click)="simuler()">
                          Valider
                        </button>
                    </div>

                    <div class="flex flex-row bg-amber-100 rounded-md shadow py-2 px-3">
                        <mat-icon class="icon-size-5 text-amber-500" [svgIcon]="'heroicons_solid:information-circle'">
                        </mat-icon>
                        <span class="ml-2 text-sm font-semibold">« Conformément à la loi 09-08, vous disposez d'un droit d'accès, de rectification et
                            d'opposition au traitement de vos données personnelles. Ce traitement est opéré
                            conformément aux autorisations obtenues par Wafa Immobilier auprès de la CNDP »
                        </span>
                    </div>
                </form>

                <!-- Résultat -->
                <div #resultat
                    *ngIf="isVisible"
                    class="md:w-1/2" 
                    [@fadeInBottom]="{value:!isScreenSmall, params: {duration: 1000, delay: 300}}">

                    <fuse-card class="relative flex flex-col px-6 pb-8 pt-3 bg-default rounded-md shadow overflow-visible ring-1 ring-primary">
    
                        <div class="absolute inset-x-0 h-8 -top-4 flex items-center justify-center">
                            <div class="flex items-center h-8 px-8 rounded-full font-medium text-center leading-none bg-primary text-on-primary">
                                Votre simulation
                            </div>
                        </div>
    
                        <div class="flex flex-col space-y-7">
    
                            <!-- mensualité -->
                            <div class="w-full mt-5">
    
                                <!-- header -->
                                <div class="flex flex-col py-3 px-5 bg-primary-500 shadow rounded-md dark:bg-white dark:bg-opacity-5 dark:text-primary-400">
    
                                    <div class="flex flex-col text-white">
                                        <div class="text-xl md:text-2xl font-semibold leading-tight tracking-tight">Mensualité</div>
                                        <div class="flex flex-col md:flex-row md:items-baseline md:space-x-2 mt-2">
                                            <span class="ml-auto">à partir de</span>
                                            <div class="flex flex-row items-baseline whitespace-nowrap ml-auto">
                                                <span class="ml-2 text-4xl font-bold leading-tight tracking-tight" #mensualiteMinId>
                                                    {{simulationPersonnaliseeStr?.mensualiteMin}}
                                                </span>
                                                <span class="ml-2 md:text-xl leading-none">MAD/mois</span>
                                            </div>
                                            <!-- <div class="flex flex-row items-baseline whitespace-nowrap max-md:ml-auto">
                                                <span class="hidden md:block">jusqu'à</span>
                                                <span class="md:hidden">à</span>
                                                <span class=" ml-2 text-4xl font-bold leading-tight tracking-tight" #mensualiteMaxId>
                                                    {{simulationPersonnaliseeStr?.mensualiteMax}}
                                                </span>
                                                <span class="ml-2 md:text-xl leading-none">MAD/mois</span>
                                            </div> -->
                                        </div>
                                    </div>
    
                                    <div class="w-8 h-1 rounded-2xl bg-second-500 mt-2"></div>
    
                                    <div class="text-sm font-semibold leading-none tracking-tight text-second-500 mt-2">
                                        Cette échéance inclut les intérêts et frais d’assurance
                                    </div>
                                </div>
    
                                <!-- details -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 max-md:gap-y-5 mt-5">
                                    
                                    <!-- Montant -->
                                    <div class="relative p-3 bg-card rounded-md shadow overflow-hidden">
                                        <!-- Border -->
                                        <div class="absolute left-0 top-0 bottom-0 w-1 bg-primary-500"></div>
                                        <!-- Content -->
                                        <div class="flex flex-col">
                                            <div class="font-medium tracking-tight leading-none">
                                                Montant de crédit
                                            </div>
                                            <div class="flex items-baseline whitespace-nowrap mt-2">
                                                <div class="font-semibold text-xl leading-tight tracking-tight" #montantId>
                                                    {{simulationPersonnaliseeStr?.montant}}
                                                </div>
                                                <div class="ml-2 text-lg leading-none">MAD</div>
                                            </div>
                                        </div>
                                        
                                    </div>
    
                                    <!-- Durée -->
                                    <div class="relative p-3 bg-card rounded-md shadow overflow-hidden">
                                        <div class="absolute left-0 top-0 bottom-0 w-1 bg-primary-500"></div>
                                        <div class="flex flex-col">
                                            <div class="font-medium tracking-tight leading-none">
                                                Durée
                                            </div>
                                            <div class="flex flex-row mt-2">
                                                <div class="flex items-baseline whitespace-nowrap">
                                                    <div class="font-semibold text-xl leading-tight tracking-tight" #nbreAnneeId>
                                                        {{simulationPersonnaliseeStr?.nbreAnnee}}
                                                    </div>
                                                    <div class="ml-2 text-lg leading-none">ans</div>
                                                </div>
                                                <div class="flex items-baseline whitespace-nowrap ml-2"
                                                    [ngClass]="{'hidden' : simulationPersonnaliseeStr?.nbreMois === 0}">
                                                    <div class="font-semibold text-xl leading-tight tracking-tight" #nbreMoisId>
                                                        {{simulationPersonnaliseeStr?.nbreMois}}
                                                    </div>
                                                    <div class="ml-2 text-lg leading-none">mois</div>
                                                </div>
                                                <div class="flex items-baseline whitespace-nowrap ml-1">
                                                    <div class="ml-2 text-lg leading-none">(</div>
                                                    <div class="font-semibold text-xl leading-tight tracking-tight" #nbreMoisId>
                                                        {{simulationPersonnaliseeStr?.duree}}
                                                    </div>
                                                    <div class="ml-2 text-lg leading-none"> mois)</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
    
                                    <!-- Coût total du crédit -->
                                    <!-- <div class="relative p-3 bg-card rounded-md shadow overflow-hidden md:col-span-2">
                                        <div class="absolute left-0 top-0 bottom-0 w-1 bg-primary-500"></div>
                                        <div class="flex flex-col">
                                            <div class="font-medium tracking-tight leading-none">
                                                Coût total du crédit
                                            </div>
                                            <div class="flex flex-col md:flex-row md:items-center md:space-x-3 mt-2">
                                                <div class="flex flex-row items-baseline whitespace-nowrap">
                                                    <span>de</span>
                                                    <span class=" ml-2 font-semibold text-xl leading-tight tracking-tight" #coutTotalMinId>
                                                        {{simulationPersonnaliseeStr?.coutTotalMin}}
                                                    </span>
                                                    <span class="ml-2 text-lg leading-none">MAD</span>
                                                </div>
                                                <div class="flex flex-row items-baseline whitespace-nowrap">
                                                    <span class="hidden md:block">jusqu'à</span>
                                                    <span class="md:hidden">à</span>
                                                    <span class="font-semibold text-xl leading-tight tracking-tight ml-2" #coutTotalMaxId>
                                                        {{simulationPersonnaliseeStr?.coutTotalMax}}
                                                    </span>
                                                    <span class="ml-2 text-lg leading-none">MAD</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div> -->
    
                                    <!-- Expertise immobilière -->
                                    <div class="relative p-3 bg-card rounded-md shadow overflow-hidden">
                                        <div class="absolute left-0 top-0 bottom-0 w-1 bg-primary-500"></div>
                                        <div class="flex flex-col">
                                            <div class="font-medium tracking-tight leading-none">
                                                Expertise immobilière
                                            </div>
                                            <div class="flex items-baseline whitespace-nowrap mt-2">
                                                <div class="font-semibold text-xl leading-tight tracking-tight"
                                                    #expertiseImmobiliereId
                                                    [ngClass]="{'text-green-600 ': !estExpImmoNum}">
                                                    {{simulationPersonnaliseeStr?.expertiseImmobiliere}}
                                                </div>
                                                <div class="ml-2 text-lg leading-none" [ngClass]="{'hidden': !estExpImmoNum}">MAD</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Frais de dossier -->
                                    <div class="relative p-3 bg-card rounded-md shadow overflow-hidden">
                                        <div class="absolute left-0 top-0 bottom-0 w-1 bg-primary-500"></div>
                                        <div class="flex flex-col">
                                            <span class="font-medium tracking-tight leading-none">
                                                Frais de dossier
                                            </span>
                                            <div class="flex items-baseline whitespace-nowrap mt-2">
                                                <div class="font-semibold text-xl leading-tight tracking-tight" 
                                                    #fraisDossierId
                                                    [ngClass]="{'text-green-600 ': !estFraisDossNum}">
                                                    {{simulationPersonnaliseeStr?.fraisDossier}}
                                                </div>
                                                <div class="ml-2 text-lg leading-none" [ngClass]="{'hidden': !estFraisDossNum}">MAD</div>
                                            </div>
                                        </div>
                                    </div>
                                    
    
                                </div>
                            </div>
    
                            <!-- frais annexes -->
                            <div class="w-full">
    
                                <div class="text-2xl font-semibold leading-tight tracking-tight">
                                    Frais annexes *
                                </div>
    
                                <!-- details -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 max-md:gap-y-5 mt-3">
    
                                    <!-- Frais d'enregistrement -->
                                    <div class="relative p-3 bg-card rounded-md shadow overflow-hidden">
                                        <div class="absolute left-0 top-0 bottom-0 w-1 bg-primary-500"></div>
                                        <div class="flex flex-col">
                                            <div class="font-medium tracking-tight leading-none">
                                                Frais d'enregistrement
                                            </div>
                                            <div class="flex items-baseline whitespace-nowrap mt-2">
                                                <div class="font-semibold text-xl leading-tight tracking-tight" #droitsEnregistrementId>
                                                    {{simulationPersonnaliseeStr?.droitsEnregistrement}}
                                                </div>
                                                <div class="ml-2 text-lg leading-none">MAD</div>
                                            </div>
                                        </div>
                                    </div>
                                    
            
                                    <!-- Frais de conservation foncière -->
                                    <div class="relative p-3 bg-card rounded-md shadow overflow-hidden">
                                        <div class="absolute left-0 top-0 bottom-0 w-1 bg-primary-500"></div>
                                        <div class="flex flex-col">
                                            <div class="font-medium tracking-tight leading-none">
                                                Frais de conservation foncière
                                            </div>
                                            <div class="flex items-baseline whitespace-nowrap mt-2">
                                                <div class="font-semibold text-xl leading-tight tracking-tight" #conservationFonciereId>
                                                    {{simulationPersonnaliseeStr?.conservationFonciere}}
                                                </div>
                                                <div class="ml-2 text-lg leading-none">MAD</div>
                                            </div>
                                        </div>
                                        
                                    </div>
    
                                </div>
    
                                <div class="italic text-sm leading-none tracking-tight text-secondary mt-2">
                                    * Ces montants sont affichés à titre indicatif et ne sont aucunement contractuels
                                </div>
                            </div>
    
                            <!-- Action -->
                            <div class="flex flex-col items-center">
                                <div class="font-semibold mb-5">
                                    Vous souhaitez détailler davantage votre simulation et connaître votre mensualité exacte ? Cliquez pour y accéder.
                                </div>
                                <button 
                                    class="w-fit"
                                    mat-flat-button
                                    [color]="'primary'"
                                    (click)="navigateToSimulationDetaillee()">
                                    Détailler ma simulation
                                </button>
                            </div>
                            
                        </div>
                        
                    </fuse-card>
                    
                </div>
            </div>
        </div>
    </div>

</div>